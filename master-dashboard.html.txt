<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Личный кабинет мастера - Запись за 5 минут</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ОСНОВНЫЕ СТИЛИ */
        body {
            background: #0a0a0a;
            color: var(--text-light);
            font-family: 'Inter', sans-serif;
        }
        
        .dashboard-container {
            display: flex;
            min-height: calc(100vh - 80px);
        }
        
        /* БОКОВОЕ МЕНЮ - СОВРЕМЕННЫЙ ДИЗАЙН */
        .sidebar {
            width: 300px;
            background: #1a1a1a;
            box-shadow: 2px 0 20px rgba(0, 0, 0, 0.5);
            position: sticky;
            top: 80px;
            height: calc(100vh - 80px);
            overflow-y: auto;
            z-index: 100;
            border-right: 1px solid rgba(138, 43, 226, 0.2);
            padding: 20px 0;
        }
        
        .sidebar-header {
            padding: 30px 20px;
            text-align: center;
            border-bottom: 1px solid rgba(138, 43, 226, 0.2);
            margin-bottom: 20px;
        }
        
        .master-avatar-sidebar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 36px;
            font-weight: bold;
            border: 3px solid rgba(138, 43, 226, 0.5);
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .master-avatar-sidebar:hover {
            transform: scale(1.05);
            border-color: #8A2BE2;
        }
        
        .master-avatar-sidebar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .avatar-change {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 12px;
            padding: 5px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .master-avatar-sidebar:hover .avatar-change {
            opacity: 1;
        }
        
        .master-name-sidebar {
            font-size: 22px;
            font-weight: 600;
            color: var(--text-light);
            margin-bottom: 5px;
        }
        
        .master-role {
            color: #8A2BE2;
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .master-rating-sidebar {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            color: #FFD700;
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .sidebar-menu {
            padding: 0 15px;
        }
        
        .menu-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 18px 20px;
            color: var(--text-gray);
            text-decoration: none;
            transition: all 0.3s ease;
            border-radius: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            border-left: 3px solid transparent;
        }
        
        .menu-item:hover {
            background: rgba(138, 43, 226, 0.1);
            color: var(--text-light);
            transform: translateX(5px);
        }
        
        .menu-item.active {
            background: rgba(138, 43, 226, 0.15);
            color: #8A2BE2;
            border-left-color: #8A2BE2;
            font-weight: 500;
        }
        
        .menu-item i {
            width: 20px;
            text-align: center;
            font-size: 18px;
        }
        
        .menu-item.logout {
            margin-top: 30px;
            color: #ff4757;
            border-top: 1px solid rgba(255,71,87,0.2);
            border-left: none;
        }
        
        .menu-item.logout:hover {
            background: rgba(255, 71, 87, 0.1);
        }
        
        /* ОСНОВНОЙ КОНТЕНТ */
        .dashboard-content {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
            background: #0f0f0f;
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
            gap: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(138, 43, 226, 0.2);
        }
        
        .dashboard-title {
            font-size: 36px;
            color: var(--text-light);
            margin: 0;
            background: linear-gradient(45deg, #8A2BE2, #9370DB);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .date-selector {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .date-btn {
            padding: 10px 20px;
            background: rgba(138, 43, 226, 0.1);
            border: 1px solid rgba(138, 43, 226, 0.2);
            border-radius: 10px;
            color: var(--text-light);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .date-btn:hover {
            background: rgba(138, 43, 226, 0.2);
        }
        
        .current-date {
            font-size: 18px;
            color: var(--text-light);
            font-weight: 500;
        }
        
        /* СТАТИСТИКА */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: #1a1a1a;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            border: 1px solid rgba(138, 43, 226, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(138, 43, 226, 0.2);
            border-color: rgba(138, 43, 226, 0.3);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(45deg, #8A2BE2, #9370DB);
        }
        
        .stat-icon {
            width: 70px;
            height: 70px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: white;
            margin-bottom: 25px;
            background: rgba(138, 43, 226, 0.2);
        }
        
        .stat-icon.blue { background: rgba(33, 150, 243, 0.2); }
        .stat-icon.green { background: rgba(46, 204, 113, 0.2); }
        .stat-icon.orange { background: rgba(255, 152, 0, 0.2); }
        .stat-icon.pink { background: rgba(255, 107, 139, 0.2); }
        
        .stat-value {
            font-size: 42px;
            font-weight: 700;
            color: var(--text-light);
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: var(--text-gray);
            font-size: 16px;
        }
        
        /* СЕКЦИИ */
        .section {
            background: #1a1a1a;
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
            margin-bottom: 40px;
            border: 1px solid rgba(138, 43, 226, 0.1);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .section-title {
            font-size: 28px;
            color: var(--text-light);
            margin: 0;
        }
        
        /* ВКЛАДКИ */
        .tabs-nav {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            border-bottom: 2px solid rgba(138, 43, 226, 0.2);
            padding-bottom: 15px;
            margin-bottom: 30px;
        }
        
        .tab-btn {
            padding: 12px 24px;
            background: rgba(138, 43, 226, 0.1);
            border: none;
            border-radius: 10px;
            color: var(--text-gray);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            font-weight: 500;
        }
        
        .tab-btn:hover {
            background: rgba(138, 43, 226, 0.2);
            color: var(--text-light);
        }
        
        .tab-btn.active {
            background: linear-gradient(45deg, #8A2BE2, #9370DB);
            color: white;
            box-shadow: 0 5px 15px rgba(138, 43, 226, 0.3);
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* БЛИЖАЙШИЕ ЗАПИСИ */
        .bookings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }
        
        .booking-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(138, 43, 226, 0.1);
            transition: all 0.3s ease;
        }
        
        .booking-card:hover {
            border-color: #8A2BE2;
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(138, 43, 226, 0.2);
        }
        
        .booking-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(138, 43, 226, 0.2);
        }
        
        .booking-date {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-light);
        }
        
        .booking-time {
            font-size: 24px;
            font-weight: 700;
            color: #8A2BE2;
            background: rgba(138, 43, 226, 0.1);
            padding: 5px 15px;
            border-radius: 10px;
        }
        
        .booking-client {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .client-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, #8A2BE2, #9370DB);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 20px;
        }
        
        .client-info h4 {
            margin: 0 0 5px 0;
            color: var(--text-light);
            font-size: 18px;
        }
        
        .client-info p {
            margin: 0;
            color: var(--text-gray);
            font-size: 14px;
        }
        
        .booking-details {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        
        .detail-item:last-child {
            border-bottom: none;
        }
        
        .booking-actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            border: none;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .confirm-btn {
            background: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
            border: 1px solid rgba(46, 204, 113, 0.3);
        }
        
        .confirm-btn:hover {
            background: rgba(46, 204, 113, 0.3);
        }
        
        .cancel-btn {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
            border: 1px solid rgba(231, 76, 60, 0.3);
        }
        
        .cancel-btn:hover {
            background: rgba(231, 76, 60, 0.3);
        }
        
        /* ФОРМЫ */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: var(--text-light);
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(138, 43, 226, 0.2);
            font-size: 16px;
            background: rgba(0, 0, 0, 0.3);
            color: var(--text-light);
            transition: all 0.3s ease;
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 120px;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #8A2BE2;
            box-shadow: 0 0 0 3px rgba(138, 43, 226, 0.1);
        }
        
        .form-submit {
            background: linear-gradient(45deg, #8A2BE2, #9370DB);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 18px 40px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 20px rgba(138, 43, 226, 0.3);
        }
        
        .form-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 30px rgba(138, 43, 226, 0.4);
        }
        
        /* РАСПИСАНИЕ */
        .schedule-container {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .schedule-sidebar {
            flex: 0 0 300px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(138, 43, 226, 0.1);
        }
        
        .schedule-main {
            flex: 1;
            min-width: 300px;
        }
        
        .schedule-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-bottom: 30px;
        }
        
        .calendar-day {
            text-align: center;
            padding: 15px 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid transparent;
        }
        
        .calendar-day:hover {
            background: rgba(138, 43, 226, 0.1);
        }
        
        .calendar-day.active {
            background: rgba(138, 43, 226, 0.2);
            border-color: #8A2BE2;
            color: #8A2BE2;
            font-weight: 600;
        }
        
        .calendar-day.has-schedule {
            border-color: #2ecc71;
        }
        
        .calendar-day-header {
            text-align: center;
            padding: 10px;
            color: var(--text-gray);
            font-weight: 500;
            text-transform: uppercase;
            font-size: 12px;
        }
        
        .time-slots {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 12px;
            margin-top: 25px;
        }
        
        .time-slot {
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(138, 43, 226, 0.2);
            font-size: 14px;
        }
        
        .time-slot:hover {
            background: rgba(138, 43, 226, 0.1);
        }
        
        .time-slot.active {
            background: linear-gradient(45deg, #8A2BE2, #9370DB);
            color: white;
            border-color: #8A2BE2;
        }
        
        .schedule-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        /* ТАБЛИЦЫ */
        .table-container {
            overflow-x: auto;
            border-radius: 15px;
            border: 1px solid rgba(138, 43, 226, 0.1);
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        .data-table th {
            text-align: left;
            padding: 18px;
            background: rgba(138, 43, 226, 0.1);
            font-weight: 600;
            color: var(--text-light);
            border-bottom: 2px solid rgba(138, 43, 226, 0.2);
        }
        
        .data-table td {
            padding: 20px 18px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            color: var(--text-gray);
        }
        
        .data-table tr:hover {
            background: rgba(138, 43, 226, 0.05);
        }
        
        /* ПОРТФОЛИО */
        .portfolio-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 25px;
        }
        
        .portfolio-item {
            position: relative;
            border-radius: 20px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(138, 43, 226, 0.1);
        }
        
        .portfolio-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(138, 43, 226, 0.3);
            border-color: #8A2BE2;
        }
        
        .portfolio-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        
        .portfolio-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            display: flex;
            align-items: flex-end;
            padding: 20px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .portfolio-item:hover .portfolio-overlay {
            opacity: 1;
        }
        
        .portfolio-actions {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .portfolio-item:hover .portfolio-actions {
            opacity: 1;
        }
        
        .portfolio-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .portfolio-btn:hover {
            background: #8A2BE2;
            transform: scale(1.1);
        }
        
        .add-photo-btn {
            width: 100%;
            height: 200px;
            border: 2px dashed rgba(138, 43, 226, 0.3);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #8A2BE2;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(138, 43, 226, 0.05);
        }
        
        .add-photo-btn:hover {
            border-color: #8A2BE2;
            background: rgba(138, 43, 226, 0.1);
        }
        
        .add-photo-btn i {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        /* ОТЗЫВЫ */
        .reviews-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        
        .review-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(138, 43, 226, 0.1);
            transition: all 0.3s ease;
        }
        
        .review-card:hover {
            border-color: #8A2BE2;
            transform: translateY(-5px);
        }
        
        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .review-client {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .client-avatar-small {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #8A2BE2, #9370DB);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }
        
        .client-info-small h4 {
            margin: 0;
            font-size: 16px;
            color: var(--text-light);
        }
        
        .client-info-small p {
            margin: 0;
            color: var(--text-gray);
            font-size: 12px;
        }
        
        .review-rating {
            display: flex;
            gap: 5px;
            color: #FFD700;
        }
        
        .review-date {
            color: var(--text-gray);
            font-size: 12px;
            margin-left: 10px;
        }
        
        .review-text {
            color: var(--text-light);
            line-height: 1.6;
            margin: 15px 0;
        }
        
        .review-service {
            color: var(--text-gray);
            font-size: 14px;
            font-style: italic;
        }
        
        /* УВЕДОМЛЕНИЯ */
        .notification-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .notification-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .notification-box {
            background: #1a1a1a;
            border-radius: 25px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            border: 2px solid #8A2BE2;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }
        
        .notification-modal.active .notification-box {
            transform: translateY(0);
        }
        
        .notification-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(45deg, #8A2BE2, #9370DB);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 30px;
            font-size: 36px;
            color: white;
        }
        
        .notification-title {
            font-size: 24px;
            color: var(--text-light);
            text-align: center;
            margin-bottom: 20px;
        }
        
        .notification-content {
            color: var(--text-gray);
            line-height: 1.6;
            margin-bottom: 30px;
        }
        
        .notification-list {
            padding-left: 20px;
            margin: 20px 0;
        }
        
        .notification-list li {
            margin-bottom: 10px;
            color: var(--text-gray);
        }
        
        .notification-actions {
            display: flex;
            gap: 15px;
        }
        
        /* АДАПТИВНОСТЬ */
        @media (max-width: 1200px) {
            .dashboard-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                position: static;
                box-shadow: none;
                border-right: none;
                border-bottom: 1px solid rgba(138, 43, 226, 0.2);
            }
            
            .sidebar-header {
                padding: 20px;
            }
            
            .sidebar-menu {
                display: flex;
                overflow-x: auto;
                padding: 0;
            }
            
            .menu-item {
                white-space: nowrap;
                border-left: none;
                border-bottom: 3px solid transparent;
            }
            
            .menu-item.active {
                border-left: none;
                border-bottom-color: #8A2BE2;
            }
        }
        
        @media (max-width: 768px) {
            .dashboard-content {
                padding: 20px;
            }
            
            .stats-cards {
                grid-template-columns: 1fr;
            }
            
            .section {
                padding: 25px;
            }
            
            .booking-card {
                padding: 20px;
            }
            
            .bookings-grid {
                grid-template-columns: 1fr;
            }
            
            .schedule-container {
                flex-direction: column;
            }
            
            .schedule-sidebar {
                flex: none;
                width: 100%;
            }
            
            .reviews-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* ДОПОЛНИТЕЛЬНЫЕ СТИЛИ */
        .status-badge {
            display: inline-block;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }
        
        .status-confirmed {
            background: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
        }
        
        .status-pending {
            background: rgba(241, 196, 15, 0.2);
            color: #f1c40f;
        }
        
        .status-cancelled {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-gray);
        }
        
        .empty-state i {
            font-size: 64px;
            margin-bottom: 20px;
            color: #8A2BE2;
        }
        
        .copy-btn {
            background: rgba(138, 43, 226, 0.1);
            color: #8A2BE2;
            border: 1px solid rgba(138, 43, 226, 0.2);
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .copy-btn:hover {
            background: rgba(138, 43, 226, 0.2);
        }
        
        .qr-code {
            width: 150px;
            height: 150px;
            background: white;
            padding: 10px;
            border-radius: 10px;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* ЗАГЛУШКИ ДЛЯ ПОЛЕЙ ТОЛЬКО ДЛЯ ЧТЕНИЯ */
        .readonly-field {
            background: rgba(0, 0, 0, 0.1) !important;
            border-color: rgba(255, 255, 255, 0.05) !important;
            color: var(--text-gray) !important;
            cursor: not-allowed !important;
        }
        
        .field-note {
            font-size: 12px;
            color: var(--text-gray);
            margin-top: 5px;
            font-style: italic;
        }
        
        /* МОДАЛЬНОЕ ОКНО ДЛЯ ДОБАВЛЕНИЯ ФОТО */
        .photo-upload-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .photo-upload-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .upload-box {
            background: #1a1a1a;
            border-radius: 25px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            border: 2px solid #8A2BE2;
            box-shadow: 0 20px 60px rgba(138, 43, 226, 0.3);
        }
        
        .upload-area {
            border: 3px dashed #8A2BE2;
            border-radius: 20px;
            padding: 60px 30px;
            text-align: center;
            margin: 30px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .upload-area:hover {
            background: rgba(138, 43, 226, 0.05);
            border-color: #9370DB;
        }
        
        .upload-area i {
            font-size: 64px;
            color: #8A2BE2;
            margin-bottom: 20px;
        }
        
        .upload-preview {
            max-width: 100%;
            max-height: 300px;
            border-radius: 15px;
            display: none;
            margin: 20px auto;
        }
    </style>
</head>
<body>
    <!-- Шапка -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">Запись за 5 минут<br>в Мысках и на Грэсе</div>
                <nav class="nav">
                    <a href="index.html" class="nav-link"><i class="fas fa-home"></i> Главная</a>
                    <a href="#" class="nav-link" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Выйти</a>
                </nav>
            </div>
        </div>
    </header>
    
    <!-- Личный кабинет -->
    <div class="dashboard-container">
        <!-- Боковое меню -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="master-avatar-sidebar" id="masterAvatar" onclick="showAvatarUpload()">
                    <div class="avatar-change">Изменить</div>
                </div>
                <h3 class="master-name-sidebar" id="masterName">Анна Петрова</h3>
                <p class="master-role" id="masterRole">Мастер красоты</p>
                <div class="master-rating-sidebar" id="masterRating">
                    <i class="fas fa-star"></i> <span id="ratingValue">0.0</span> (<span id="reviewsCount">0</span> отзывов)
                </div>
            </div>
            
            <nav class="sidebar-menu">
                <a href="#" class="menu-item active" onclick="switchTab('dashboard')">
                    <i class="fas fa-chart-line"></i> Панель управления
                </a>
                <a href="#" class="menu-item" onclick="switchTab('profile')">
                    <i class="fas fa-user"></i> Мой профиль
                </a>
                <a href="#" class="menu-item" onclick="switchTab('schedule')">
                    <i class="fas fa-calendar-alt"></i> Расписание
                </a>
                <a href="#" class="menu-item" onclick="switchTab('bookings')">
                    <i class="fas fa-calendar-check"></i> Записи клиентов
                </a>
                <a href="#" class="menu-item" onclick="switchTab('services')">
                    <i class="fas fa-spa"></i> Услуги и цены
                </a>
                <a href="#" class="menu-item" onclick="switchTab('portfolio')">
                    <i class="fas fa-images"></i> Портфолио
                </a>
                <a href="#" class="menu-item" onclick="switchTab('reviews')">
                    <i class="fas fa-star"></i> Отзывы
                </a>
                <a href="#" class="menu-item" onclick="switchTab('settings')">
                    <i class="fas fa-cog"></i> Настройки
                </a>
                <a href="#" class="menu-item logout" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Выйти
                </a>
            </nav>
        </aside>
        
        <!-- Основной контент -->
        <main class="dashboard-content">
            <!-- Вкладка Панель управления -->
            <div id="tab-dashboard" class="tab-content active">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Панель управления</h1>
                    <div class="date-selector">
                        <button class="date-btn" onclick="changeDate(-1)">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <div class="current-date" id="currentDate">Сегодня</div>
                        <button class="date-btn" onclick="changeDate(1)">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Статистика -->
                <div class="stats-cards">
                    <div class="stat-card">
                        <div class="stat-icon pink">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="stat-value" id="todayBookings">0</div>
                        <div class="stat-label">Записей сегодня</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon green">
                            <i class="fas fa-ruble-sign"></i>
                        </div>
                        <div class="stat-value" id="todayRevenue">0 ₽</div>
                        <div class="stat-label">Доход сегодня</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon orange">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-value" id="totalClients">0</div>
                        <div class="stat-label">Всего клиентов</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon blue">
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="stat-value" id="masterRatingValue">0.0</div>
                        <div class="stat-label">Ваш рейтинг</div>
                    </div>
                </div>
                
                <!-- Ближайшие записи (3 дня) -->
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">Ближайшие записи</h2>
                        <div class="tabs-nav">
                            <button class="tab-btn active" onclick="filterUpcomingBookings('today')">Сегодня</button>
                            <button class="tab-btn" onclick="filterUpcomingBookings('tomorrow')">Завтра</button>
                            <button class="tab-btn" onclick="filterUpcomingBookings('after_tomorrow')">Послезавтра</button>
                        </div>
                    </div>
                    
                    <div class="bookings-grid" id="upcomingBookingsGrid">
                        <!-- Ближайшие записи загрузятся через JS -->
                    </div>
                </div>
            </div>
            
            <!-- Вкладка Мой профиль -->
            <div id="tab-profile" class="tab-content">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Мой профиль</h1>
                </div>
                
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">Редактирование профиля</h2>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Имя</label>
                            <input type="text" id="profileFirstName" class="form-input" placeholder="Анна">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Фамилия</label>
                            <input type="text" id="profileLastName" class="form-input" placeholder="Петрова">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Email <span class="field-note">(изменяется через администратора)</span></label>
                            <input type="email" id="profileEmail" class="form-input readonly-field" placeholder="anna@mail.ru" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Телефон <span class="field-note">(изменяется через администратора)</span></label>
                            <input type="tel" id="profilePhone" class="form-input readonly-field" placeholder="+7 (999) 123-45-67" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Город</label>
                            <select id="profileCity" class="form-select">
                                <option value="Мыски">Мыски</option>
                                <option value="ГРЭС">ГРЭС</option>
                                <option value="Москва">Москва</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Опыт (лет)</label>
                            <input type="number" id="profileExperience" class="form-input" value="3" min="0" max="50">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">О себе</label>
                        <textarea id="profileDescription" class="form-textarea" placeholder="Расскажите о себе, своем опыте, специализации..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Специализация</label>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 15px 0;">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" name="masterSpecialization" value="MANICURE_PEDICURE" checked>
                                <span>Маникюр</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" name="masterSpecialization" value="MEN_HAIRCUT">
                                <span>Мужская стрижка</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" name="masterSpecialization" value="WOMEN_HAIRCUT">
                                <span>Женская стрижка</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" name="masterSpecialization" value="EYEBROWS">
                                <span>Брови</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" name="masterSpecialization" value="EYELASHES">
                                <span>Ресницы</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Telegram (для связи с клиентами)</label>
                        <input type="text" id="profileTelegram" class="form-input" placeholder="@anna_beauty">
                    </div>
                    
                    <button class="form-submit" onclick="saveProfile()">
                        <i class="fas fa-save"></i> Сохранить изменения
                    </button>
                </div>
            </div>
            
            <!-- Вкладка Расписание -->
            <div id="tab-schedule" class="tab-content">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Расписание</h1>
                    <div class="date-selector">
                        <button class="date-btn" onclick="changeScheduleWeek(-1)">
                            <i class="fas fa-chevron-left"></i> Предыдущая неделя
                        </button>
                        <div class="current-date" id="scheduleWeek">Эта неделя</div>
                        <button class="date-btn" onclick="changeScheduleWeek(1)">
                            Следующая неделя <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
                
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">Настройка рабочего времени</h2>
                        <button class="form-submit" onclick="copyScheduleToNextWeek()">
                            <i class="fas fa-copy"></i> Скопировать на следующую неделю
                        </button>
                    </div>
                    
                    <div class="schedule-container">
                        <div class="schedule-sidebar">
                            <h3 style="color: var(--text-light); margin-bottom: 20px;">Выберите дату</h3>
                            <div class="schedule-calendar" id="scheduleCalendar">
                                <!-- Календарь загрузится через JS -->
                            </div>
                            
                            <div id="selectedDateInfo" style="display: none;">
                                <h3 style="color: var(--text-light); margin: 25px 0 15px 0;">
                                    Время работы на <span id="selectedDateText"></span>
                                </h3>
                                <div class="time-slots" id="timeSlotsContainer">
                                    <!-- Временные слоты загрузятся через JS -->
                                </div>
                                
                                <div class="form-group" style="margin-top: 20px;">
                                    <label class="form-label">Добавить время</label>
                                    <div style="display: flex; gap: 10px;">
                                        <input type="time" id="newTimeInput" class="form-input" style="flex: 1;">
                                        <button class="copy-btn" onclick="addTimeSlot()">
                                            <i class="fas fa-plus"></i> Добавить
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="schedule-actions">
                                    <button class="action-btn confirm-btn" onclick="saveDailySchedule()">
                                        <i class="fas fa-save"></i> Сохранить
                                    </button>
                                    <button class="action-btn cancel-btn" onclick="clearDailySchedule()">
                                        <i class="fas fa-trash"></i> Очистить
                                    </button>
                                </div>
                            </div>
                            
                            <div id="noDateSelected" class="empty-state">
                                <i class="fas fa-calendar-alt"></i>
                                <p>Выберите дату для настройки времени работы</p>
                            </div>
                        </div>
                        
                        <div class="schedule-main">
                            <h3 style="color: var(--text-light); margin-bottom: 20px;">Ваше расписание на неделю</h3>
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>День недели</th>
                                            <th>Дата</th>
                                            <th>Время работы</th>
                                            <th>Записей</th>
                                            <th>Статус</th>
                                        </tr>
                                    </thead>
                                    <tbody id="weekScheduleTable">
                                        <!-- Расписание на неделю загрузится через JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Вкладка Записи клиентов -->
            <div id="tab-bookings" class="tab-content">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Записи клиентов</h1>
                    <div class="date-selector">
                        <button class="date-btn" onclick="changeBookingsView('day')">
                            <i class="fas fa-calendar-day"></i> День
                        </button>
                        <button class="date-btn active" onclick="changeBookingsView('week')">
                            <i class="fas fa-calendar-week"></i> Неделя
                        </button>
                        <button class="date-btn" onclick="changeBookingsView('month')">
                            <i class="fas fa-calendar-alt"></i> Месяц
                        </button>
                    </div>
                </div>
                
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">Все записи</h2>
                        <div style="display: flex; gap: 15px;">
                            <input type="text" id="bookingsSearch" class="form-input" placeholder="Поиск по имени клиента..." style="width: 250px;">
                            <select id="bookingsFilter" class="form-select" style="width: 200px;">
                                <option value="all">Все статусы</option>
                                <option value="confirmed">Подтвержденные</option>
                                <option value="pending">Ожидают</option>
                                <option value="cancelled">Отмененные</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Дата и время</th>
                                    <th>Клиент</th>
                                    <th>Услуга</th>
                                    <th>Телефон</th>
                                    <th>Сумма</th>
                                    <th>Статус</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody id="bookingsTable">
                                <!-- Записи клиентов загрузятся через JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Вкладка Услуги и цены -->
            <div id="tab-services" class="tab-content">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Услуги и цены</h1>
                    <button class="form-submit" onclick="showAddServiceForm()">
                        <i class="fas fa-plus"></i> Добавить услугу
                    </button>
                </div>
                
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">Мои услуги</h2>
                    </div>
                    
                    <!-- Форма добавления услуги -->
                    <div id="addServiceForm" style="display: none; margin-bottom: 40px; padding: 30px; background: rgba(0,0,0,0.3); border-radius: 20px;">
                        <h3 style="color: var(--text-light); margin-bottom: 25px;">Добавить новую услугу</h3>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Название услуги</label>
                                <input type="text" id="serviceName" class="form-input" placeholder="Например: Маникюр">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Категория</label>
                                <select id="serviceCategory" class="form-select">
                                    <option value="MANICURE_PEDICURE">Маникюр и педикюр</option>
                                    <option value="MEN_HAIRCUT">Мужская стрижка</option>
                                    <option value="WOMEN_HAIRCUT">Женская стрижка</option>
                                    <option value="EYEBROWS">Брови</option>
                                    <option value="EYELASHES">Ресницы</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Цена (₽)</label>
                                <input type="number" id="servicePrice" class="form-input" placeholder="1500" min="0">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Длительность (мин)</label>
                                <select id="serviceDuration" class="form-select">
                                    <option value="30">30 минут</option>
                                    <option value="45">45 минут</option>
                                    <option value="60" selected>60 минут</option>
                                    <option value="90">90 минут</option>
                                    <option value="120">120 минут</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Краткое описание</label>
                            <textarea id="serviceDescription" class="form-textarea" placeholder="Опишите услугу, что входит в стоимость..." rows="3"></textarea>
                        </div>
                        
                        <div style="display: flex; gap: 15px; margin-top: 30px;">
                            <button class="action-btn cancel-btn" style="flex: 1;" onclick="hideAddServiceForm()">
                                Отмена
                            </button>
                            <button class="form-submit" style="flex: 2;" onclick="addService()">
                                Добавить услугу
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Услуга</th>
                                    <th>Описание</th>
                                    <th>Цена</th>
                                    <th>Длительность</th>
                                    <th>Популярность</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody id="servicesTable">
                                <!-- Услуги загрузятся через JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Вкладка Портфолио -->
            <div id="tab-portfolio" class="tab-content">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Портфолио</h1>
                    <button class="form-submit" onclick="showPhotoUploadModal()">
                        <i class="fas fa-plus"></i> Добавить фото
                    </button>
                </div>
                
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">Мои работы</h2>
                        <div style="display: flex; gap: 15px;">
                            <select id="portfolioFilter" class="form-select" style="width: 200px;">
                                <option value="all">Все услуги</option>
                                <option value="MANICURE_PEDICURE">Маникюр</option>
                                <option value="MEN_HAIRCUT">Мужская стрижка</option>
                                <option value="WOMEN_HAIRCUT">Женская стрижка</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="portfolio-grid" id="portfolioGrid">
                        <!-- Портфолио загрузятся через JS -->
                    </div>
                </div>
            </div>
            
            <!-- Вкладка Отзывы -->
            <div id="tab-reviews" class="tab-content">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Отзывы клиентов</h1>
                    <div class="date-selector">
                        <select id="reviewsFilter" class="form-select" style="width: 200px;">
                            <option value="all">Все отзывы</option>
                            <option value="5">5 звёзд</option>
                            <option value="4">4 звезды</option>
                            <option value="3">3 звезды</option>
                            <option value="2">2 звезды</option>
                            <option value="1">1 звезда</option>
                        </select>
                    </div>
                </div>
                
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">Отзывы о вас</h2>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="font-size: 24px; color: #FFD700;">
                                <i class="fas fa-star"></i>
                                <span id="averageRating">0.0</span>
                                <span style="color: var(--text-gray); font-size: 16px;">(<span id="totalReviewsCount">0</span> отзывов)</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="reviews-grid" id="reviewsGrid">
                        <!-- Отзывы загрузятся через JS -->
                    </div>
                </div>
            </div>
            
            <!-- Вкладка Настройки -->
            <div id="tab-settings" class="tab-content">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Настройки</h1>
                </div>
                
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">Настройки аккаунта</h2>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Уведомления о новых записях</label>
                            <div style="display: flex; align-items: center; gap: 20px; margin-top: 10px;">
                                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                    <input type="checkbox" id="notifyEmail" checked>
                                    <span>По email</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                    <input type="checkbox" id="notifySMS" checked>
                                    <span>По SMS</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                    <input type="checkbox" id="notifyTelegram">
                                    <span>В Telegram</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Автоподтверждение записей</label>
                            <div style="margin-top: 10px;">
                                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                    <input type="checkbox" id="autoConfirmBookings" checked>
                                    <span>Автоматически подтверждать новые записи</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Время на подтверждение записи (часов)</label>
                        <select id="confirmTime" class="form-select" style="max-width: 200px;">
                            <option value="1">1 час</option>
                            <option value="2">2 часа</option>
                            <option value="4">4 часа</option>
                            <option value="12">12 часов</option>
                            <option value="24" selected>24 часа</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Минимальная предоплата (%)</label>
                        <select id="prepaymentPercent" class="form-select" style="max-width: 200px;">
                            <option value="30">30%</option>
                            <option value="50" selected>50%</option>
                            <option value="70">70%</option>
                            <option value="100">100%</option>
                        </select>
                    </div>
                    
                    <h3 style="color: var(--text-light); margin: 40px 0 20px 0;">Безопасность</h3>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Новый пароль <span class="field-note">(обратитесь к администратору для смены пароля)</span></label>
                            <input type="password" id="newPassword" class="form-input readonly-field" placeholder="Обратитесь к администратору" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Повторите пароль</label>
                            <input type="password" id="confirmPassword" class="form-input readonly-field" placeholder="Обратитесь к администратору" readonly>
                        </div>
                    </div>
                    
                    <div style="margin: 40px 0;">
                        <h3 style="color: var(--text-light); margin-bottom: 20px;">QR-код для быстрой записи</h3>
                        <div class="qr-code" id="masterQRCode">
                            <div style="text-align: center; color: #333;">
                                <i class="fas fa-qrcode" style="font-size: 100px;"></i>
                                <p style="margin-top: 10px;">QR-код</p>
                            </div>
                        </div>
                        <p style="color: var(--text-gray); text-align: center; margin-top: 15px;">
                            Клиенты могут отсканировать этот код для быстрой записи
                        </p>
                        <button class="copy-btn" onclick="downloadQRCode()" style="display: block; margin: 20px auto;">
                            <i class="fas fa-download"></i> Скачать QR-код
                        </button>
                    </div>
                    
                    <button class="form-submit" onclick="saveSettings()">
                        <i class="fas fa-save"></i> Сохранить настройки
                    </button>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Модальное окно загрузки фото -->
    <div class="photo-upload-modal" id="photoUploadModal">
        <div class="upload-box">
            <h3 style="color: var(--text-light); margin-bottom: 30px; text-align: center;">Добавить фото в портфолио</h3>
            
            <div class="upload-area" onclick="document.getElementById('photoFileInput').click()">
                <i class="fas fa-cloud-upload-alt"></i>
                <h4 style="color: var(--text-light); margin-bottom: 10px;">Перетащите фото сюда</h4>
                <p style="color: var(--text-gray);">или нажмите для выбора файла</p>
                <input type="file" id="photoFileInput" accept="image/*" style="display: none;" onchange="previewPhoto(this)">
            </div>
            
            <img id="photoPreview" class="upload-preview" alt="Предпросмотр">
            
            <div class="form-group" style="margin-top: 30px;">
                <label class="form-label">Название работы</label>
                <input type="text" id="photoTitle" class="form-input" placeholder="Например: Вечерний маникюр">
            </div>
            
            <div class="form-group">
                <label class="form-label">Услуга</label>
                <select id="photoService" class="form-select">
                    <option value="MANICURE_PEDICURE">Маникюр</option>
                    <option value="MEN_HAIRCUT">Мужская стрижка</option>
                    <option value="WOMEN_HAIRCUT">Женская стрижка</option>
                    <option value="EYEBROWS">Брови</option>
                    <option value="EYELASHES">Ресницы</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Описание</label>
                <textarea id="photoDescription" class="form-textarea" placeholder="Опишите работу..." rows="2"></textarea>
            </div>
            
            <div style="display: flex; gap: 15px; margin-top: 30px;">
                <button class="action-btn cancel-btn" style="flex: 1;" onclick="closePhotoUploadModal()">
                    Отмена
                </button>
                <button class="form-submit" style="flex: 2;" onclick="uploadPhoto()" id="uploadPhotoBtn">
                    <i class="fas fa-upload"></i> Загрузить фото
                </button>
            </div>
        </div>
    </div>
    
    <!-- Модальное окно отмены записи -->
    <div class="notification-modal" id="cancelBookingModal">
        <div class="notification-box">
            <div class="notification-icon">
                <i class="fas fa-phone-alt"></i>
            </div>
            <h3 class="notification-title">Отмена записи</h3>
            <div class="notification-content">
                <p>Вы собираетесь отменить запись. Пожалуйста, выполните следующие действия:</p>
                <ul class="notification-list">
                    <li>Позвоните клиенту и сообщите об отмене записи</li>
                    <li>Верните предоплату клиенту в течение 24 часов</li>
                    <li>Удалите это время из своего расписания</li>
                    <li>Если у вас изменились планы, обновите свое расписание</li>
                </ul>
                <p><strong>Клиент:</strong> <span id="cancelClientName">Анна Иванова</span></p>
                <p><strong>Телефон:</strong> <span id="cancelClientPhone">+7 (999) 123-45-67</span></p>
                <p><strong>Дата и время:</strong> <span id="cancelDateTime">15 апреля, 14:30</span></p>
            </div>
            <div class="notification-actions">
                <button class="action-btn cancel-btn" style="flex: 1;" onclick="closeCancelModal()">
                    Отмена
                </button>
                <button class="action-btn confirm-btn" style="flex: 2;" onclick="confirmCancelBooking()">
                    <i class="fas fa-check"></i> Я выполнил все действия
                </button>
            </div>
        </div>
    </div>
    
    <!-- Футер -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Запись за 5 минут © 2024</h3>
                    <p>Быстрая запись к мастерам красоты</p>
                </div>
                <div class="footer-section">
                    <h4>КОНТАКТЫ</h4>
                    <p><i class="fas fa-phone"></i> <a href="tel:+79991234567">+7 (999) 123-45-67</a></p>
                    <p><i class="fas fa-envelope"></i> info@zapis5min.ru</p>
                    <p><i class="fas fa-map-marker-alt"></i> г. Москва, ул. Красивая, д. 1</p>
                </div>
                <div class="footer-section">
                    <h4>ТЕЛЕГРАМ</h4>
                    <p><i class="fab fa-telegram"></i> <a href="https://t.me/zapis5min" target="_blank">Канал: @zapis5min</a></p>
                    <p><i class="fas fa-robot"></i> <a href="https://t.me/zapis5min_bot" target="_blank">Помощник: @zapis5min_bot</a></p>
                </div>
            </div>
        </div>
    </footer>

    <script src="main.js"></script>
    <script src="data.js"></script>
    <script>
        // ЛОГИКА ЛИЧНОГО КАБИНЕТА МАСТЕРА - ИСПРАВЛЕННАЯ ВЕРСИЯ
        
        let currentTab = 'dashboard';
        let currentMaster = null;
        let currentDate = new Date();
        let selectedScheduleDate = null;
        let scheduleWeekStart = getWeekStart(new Date());
        let bookingToCancel = null;
        let masterPortfolio = [];
        let masterServices = [];
        let masterSchedule = {};
        let masterReviews = [];

        // Загрузка данных при старте
        document.addEventListener('DOMContentLoaded', function() {
            // Проверяем авторизацию
            const currentUser = checkAuth();
            if (!currentUser) {
                window.location.href = 'auth.html';
                return;
            }
            
            if (currentUser.role !== 'master') {
                alert('Доступ только для мастеров');
                window.location.href = 'index.html';
                return;
            }
            
            // Загружаем данные мастера
            loadMasterData(currentUser);
            
            // Загружаем статистику
            loadDashboardStats();
            
            // Загружаем ближайшие записи
            loadUpcomingBookings();
            
            // Загружаем портфолио
            loadPortfolio();
            
            // Загружаем услуги
            loadMasterServices();
            
            // Загружаем расписание
            loadMasterSchedule();
            
            // Загружаем отзывы
            loadReviews();
            
            // Обновляем дату
            updateDateDisplay();
            
            // Настройка поиска записей
            const searchInput = document.getElementById('bookingsSearch');
            const filterSelect = document.getElementById('bookingsFilter');
            
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    filterBookings();
                });
            }
            
            if (filterSelect) {
                filterSelect.addEventListener('change', function() {
                    filterBookings();
                });
            }
            
            // Настройка фильтра отзывов
            const reviewsFilter = document.getElementById('reviewsFilter');
            if (reviewsFilter) {
                reviewsFilter.addEventListener('change', function() {
                    filterReviews(this.value);
                });
            }
        });

        // Загрузка данных мастера
        function loadMasterData(user) {
            const masters = Zapis5MinData.getMasters();
            currentMaster = masters.find(m => m.user_id === user.id) || masters[0];
            
            if (!currentMaster) {
                alert('Профиль мастера не найден');
                logout();
                return;
            }
            
            // Заполняем информацию в сайдбаре
            document.getElementById('masterName').textContent = currentMaster.name;
            document.getElementById('masterRole').textContent = 'Мастер красоты';
            
            // Устанавливаем аватар
            const avatarDiv = document.getElementById('masterAvatar');
            if (currentMaster.avatar_url) {
                avatarDiv.innerHTML = `
                    <img src="${currentMaster.avatar_url}" alt="${currentMaster.name}">
                    <div class="avatar-change">Изменить</div>
                `;
            } else {
                const initials = getInitials(currentMaster.name);
                avatarDiv.style.background = currentMaster.avatar_color || '#8A2BE2';
                avatarDiv.innerHTML = initials + '<div class="avatar-change">Изменить</div>';
            }
            
            // Обновляем рейтинг
            updateRatingDisplay();
            
            // Заполняем форму профиля
            const nameParts = currentMaster.name.split(' ');
            document.getElementById('profileFirstName').value = nameParts[0] || '';
            document.getElementById('profileLastName').value = nameParts.slice(1).join(' ') || '';
            document.getElementById('profileEmail').value = user.email || '';
            document.getElementById('profilePhone').value = currentMaster.phone || '';
            document.getElementById('profileCity').value = currentMaster.city || 'Москва';
            document.getElementById('profileExperience').value = currentMaster.experience || 3;
            document.getElementById('profileDescription').value = currentMaster.description || '';
            document.getElementById('profileTelegram').value = currentMaster.telegram || '';
            
            // Устанавливаем специализации
            document.querySelectorAll('input[name="masterSpecialization"]').forEach(cb => {
                cb.checked = currentMaster.specialties?.includes(cb.value) || false;
            });
        }

        // Обновление отображения рейтинга
        function updateRatingDisplay() {
            if (!currentMaster) return;
            
            const ratingValue = document.getElementById('ratingValue');
            const reviewsCount = document.getElementById('reviewsCount');
            const averageRating = document.getElementById('averageRating');
            const totalReviewsCount = document.getElementById('totalReviewsCount');
            
            // Загружаем отзывы
            const reviews = Zapis5MinData.getReviews();
            const masterReviews = reviews.filter(r => r.master_id === currentMaster.id);
            
            // Рассчитываем средний рейтинг
            let avgRating = 0;
            if (masterReviews.length > 0) {
                const sum = masterReviews.reduce((acc, review) => acc + review.rating, 0);
                avgRating = sum / masterReviews.length;
            }
            
            // Обновляем отображение
            const displayRating = avgRating.toFixed(1);
            ratingValue.textContent = displayRating;
            reviewsCount.textContent = masterReviews.length;
            
            if (averageRating) averageRating.textContent = displayRating;
            if (totalReviewsCount) totalReviewsCount.textContent = masterReviews.length;
            
            // Обновляем значение в статистике
            const ratingStat = document.getElementById('masterRatingValue');
            if (ratingStat) ratingStat.textContent = displayRating;
        }

        // Переключение вкладок
        function switchTab(tabName) {
            currentTab = tabName;
            
            // Скрываем все вкладки
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            // Убираем активный класс со всех пунктов меню
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Показываем нужную вкладку
            document.getElementById(`tab-${tabName}`).style.display = 'block';
            
            // Активируем нужный пункт меню
            const activeMenuItem = Array.from(document.querySelectorAll('.menu-item')).find(item => 
                item.textContent.includes(tabName === 'dashboard' ? 'Панель' : 
                tabName === 'profile' ? 'профиль' :
                tabName === 'schedule' ? 'Расписание' :
                tabName === 'bookings' ? 'Записи' :
                tabName === 'services' ? 'Услуги' :
                tabName === 'portfolio' ? 'Портфолио' :
                tabName === 'reviews' ? 'Отзывы' :
                tabName === 'settings' ? 'Настройки' : '')
            );
            
            if (activeMenuItem) {
                activeMenuItem.classList.add('active');
            }
            
            // Обновляем данные для вкладки
            switch(tabName) {
                case 'dashboard':
                    loadDashboardStats();
                    loadUpcomingBookings();
                    break;
                case 'schedule':
                    renderScheduleCalendar();
                    renderWeekSchedule();
                    break;
                case 'bookings':
                    loadAllBookings();
                    break;
                case 'services':
                    loadMasterServices();
                    break;
                case 'portfolio':
                    loadPortfolio();
                    break;
                case 'reviews':
                    loadReviews();
                    break;
            }
        }

        // ЗАГРУЗКА СТАТИСТИКИ
        function loadDashboardStats() {
            if (!currentMaster) return;
            
            const bookings = Zapis5MinData.getBookings();
            const today = new Date().toISOString().split('T')[0];
            
            // Записи на сегодня
            const todayBookings = bookings.filter(b => 
                b.master_id === currentMaster.id && 
                b.date === today &&
                b.status === 'confirmed'
            ).length;
            
            // Доход за сегодня
            const todayRevenue = bookings.filter(b => 
                b.master_id === currentMaster.id && 
                b.date === today &&
                b.status === 'confirmed'
            ).reduce((sum, booking) => sum + (booking.price || 0), 0);
            
            // Всего уникальных клиентов
            const clientIds = new Set();
            bookings.forEach(b => {
                if (b.master_id === currentMaster.id && b.client_id) {
                    clientIds.add(b.client_id);
                }
            });
            
            // Обновляем статистику
            document.getElementById('todayBookings').textContent = todayBookings;
            document.getElementById('todayRevenue').textContent = todayRevenue.toLocaleString() + ' ₽';
            document.getElementById('totalClients').textContent = clientIds.size;
            updateRatingDisplay();
        }

        // БЛИЖАЙШИЕ ЗАПИСИ (3 ДНЯ)
        function loadUpcomingBookings() {
            if (!currentMaster) return;
            
            const bookings = Zapis5MinData.getBookings();
            const users = Zapis5MinData.getUsers();
            
            // Фильтруем записи мастера на ближайшие 3 дня
            const today = new Date();
            const upcomingDates = [
                today,
                new Date(today.getTime() + 24 * 60 * 60 * 1000),
                new Date(today.getTime() + 48 * 60 * 60 * 1000)
            ];
            
            const upcomingBookings = bookings.filter(b => 
                b.master_id === currentMaster.id && 
                b.status === 'confirmed' &&
                upcomingDates.some(date => {
                    const bookingDate = new Date(b.date);
                    return bookingDate.toDateString() === date.toDateString();
                })
            ).sort((a, b) => {
                // Сортируем по дате и времени
                const dateA = new Date(a.date + 'T' + a.time);
                const dateB = new Date(b.date + 'T' + b.time);
                return dateA - dateB;
            });
            
            const grid = document.getElementById('upcomingBookingsGrid');
            if (!grid) return;
            
            if (upcomingBookings.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <i class="fas fa-calendar-times"></i>
                        <h3 style="color: var(--text-light); margin-bottom: 10px;">Нет предстоящих записей</h3>
                        <p>На ближайшие 3 дня записей нет</p>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = '';
            
            upcomingBookings.forEach(booking => {
                const client = users.find(u => u.id === booking.client_id);
                const service = getServiceById(booking.service_id);
                
                const bookingDate = new Date(booking.date);
                const dateString = bookingDate.toLocaleDateString('ru-RU', {
                    weekday: 'short',
                    day: 'numeric',
                    month: 'short'
                });
                
                const timeString = formatTime(booking.time);
                
                const bookingCard = document.createElement('div');
                bookingCard.className = 'booking-card';
                bookingCard.innerHTML = `
                    <div class="booking-header">
                        <div class="booking-date">${dateString}</div>
                        <div class="booking-time">${timeString}</div>
                    </div>
                    
                    <div class="booking-client">
                        <div class="client-avatar">
                            ${getInitials(client?.name || 'Клиент')}
                        </div>
                        <div class="client-info">
                            <h4>${client?.name || 'Клиент'}</h4>
                            <p>${client?.phone || ''}</p>
                        </div>
                    </div>
                    
                    <div class="booking-details">
                        <div class="detail-item">
                            <span>Услуга:</span>
                            <span style="color: var(--text-light); font-weight: 500;">${service?.name || 'Услуга'}</span>
                        </div>
                        <div class="detail-item">
                            <span>Стоимость:</span>
                            <span style="color: var(--text-light); font-weight: 500;">${booking.price?.toLocaleString() || '0'} ₽</span>
                        </div>
                        <div class="detail-item">
                            <span>Статус:</span>
                            <span class="status-badge status-confirmed">✓ Подтверждена</span>
                        </div>
                    </div>
                    
                    <div class="booking-actions">
                        <button class="action-btn confirm-btn" onclick="confirmBooking(${booking.id})">
                            <i class="fas fa-check"></i> Подтвердить
                        </button>
                        <button class="action-btn cancel-btn" onclick="showCancelModal(${booking.id})">
                            <i class="fas fa-times"></i> Отменить
                        </button>
                    </div>
                `;
                
                grid.appendChild(bookingCard);
            });
        }

        function filterUpcomingBookings(filter) {
            // Обновляем активную кнопку
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // В реальном приложении здесь была бы фильтрация
            // Для демо просто обновляем
            loadUpcomingBookings();
        }

        // ПРОФИЛЬ - СОХРАНЕНИЕ ИЗМЕНЕНИЙ
        function saveProfile() {
            if (!currentMaster) return;
            
            // Собираем данные
            const firstName = document.getElementById('profileFirstName').value.trim();
            const lastName = document.getElementById('profileLastName').value.trim();
            const city = document.getElementById('profileCity').value;
            const experience = parseInt(document.getElementById('profileExperience').value) || 0;
            const description = document.getElementById('profileDescription').value.trim();
            const telegram = document.getElementById('profileTelegram').value.trim();
            
            // Специализации
            const specializations = [];
            document.querySelectorAll('input[name="masterSpecialization"]:checked').forEach(cb => {
                specializations.push(cb.value);
            });
            
            // Обновляем данные мастера
            const masters = Zapis5MinData.getMasters();
            const masterIndex = masters.findIndex(m => m.id === currentMaster.id);
            
            if (masterIndex !== -1) {
                masters[masterIndex].name = `${firstName} ${lastName}`;
                masters[masterIndex].city = city;
                masters[masterIndex].experience = experience;
                masters[masterIndex].description = description;
                masters[masterIndex].telegram = telegram;
                masters[masterIndex].specialties = specializations;
                
                Zapis5MinData.updateMasters(masters);
                
                // Обновляем текущего мастера
                currentMaster = masters[masterIndex];
                
                // Обновляем отображение
                const currentUser = checkAuth();
                loadMasterData(currentUser);
                
                alert('Профиль успешно сохранен!');
                showMessage('Профиль успешно сохранен!', 'success');
            }
        }

        // РАСПИСАНИЕ
        function renderScheduleCalendar() {
            const calendar = document.getElementById('scheduleCalendar');
            if (!calendar) return;
            
            // Очищаем календарь
            calendar.innerHTML = '';
            
            // Добавляем заголовки дней недели
            const dayNames = ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'];
            dayNames.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-day-header';
                dayHeader.textContent = day;
                calendar.appendChild(dayHeader);
            });
            
            // Генерируем дни недели
            const weekDates = getWeekDates(scheduleWeekStart);
            
            weekDates.forEach(date => {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = date.getDate();
                
                // Проверяем, есть ли расписание на этот день
                const dateStr = date.toISOString().split('T')[0];
                if (masterSchedule[dateStr] && masterSchedule[dateStr].length > 0) {
                    dayElement.classList.add('has-schedule');
                }
                
                // Если это выбранная дата
                if (selectedScheduleDate && selectedScheduleDate.toDateString() === date.toDateString()) {
                    dayElement.classList.add('active');
                }
                
                // Если это сегодня
                const today = new Date();
                if (date.toDateString() === today.toDateString()) {
                    dayElement.style.border = '2px solid #8A2BE2';
                }
                
                dayElement.addEventListener('click', () => selectScheduleDate(date));
                
                calendar.appendChild(dayElement);
            });
        }

        function selectScheduleDate(date) {
            selectedScheduleDate = date;
            
            // Обновляем активный день в календаре
            document.querySelectorAll('.calendar-day').forEach(day => {
                day.classList.remove('active');
            });
            
            event.target.classList.add('active');
            
            // Показываем настройки времени для выбранной даты
            document.getElementById('noDateSelected').style.display = 'none';
            document.getElementById('selectedDateInfo').style.display = 'block';
            
            // Форматируем дату
            const dateFormatter = new Intl.DateTimeFormat('ru-RU', {
                weekday: 'long',
                day: 'numeric',
                month: 'long'
            });
            
            document.getElementById('selectedDateText').textContent = dateFormatter.format(date);
            
            // Загружаем временные слоты для этой даты
            loadTimeSlotsForDate(date);
        }

        function loadTimeSlotsForDate(date) {
            const dateStr = date.toISOString().split('T')[0];
            const timeSlotsContainer = document.getElementById('timeSlotsContainer');
            
            // Очищаем контейнер
            timeSlotsContainer.innerHTML = '';
            
            // Получаем слоты для этой дата
            const slots = masterSchedule[dateStr] || [];
            
            // Сортируем слоты по времени
            slots.sort();
            
            // Добавляем слоты
            slots.forEach(time => {
                const timeSlot = document.createElement('div');
                timeSlot.className = 'time-slot';
                timeSlot.textContent = formatTime(time);
                timeSlot.dataset.time = time;
                
                timeSlot.addEventListener('click', function() {
                    // Удаляем слот при клике
                    removeTimeSlot(dateStr, time);
                });
                
                timeSlotsContainer.appendChild(timeSlot);
            });
            
            // Если слотов нет, показываем сообщение
            if (slots.length === 0) {
                timeSlotsContainer.innerHTML = `
                    <div style="text-align: center; color: var(--text-gray); padding: 20px;">
                        <i class="far fa-clock" style="font-size: 24px; margin-bottom: 10px; display: block;"></i>
                        <p>Время работы не установлено</p>
                    </div>
                `;
            }
        }

        function addTimeSlot() {
            if (!selectedScheduleDate) {
                alert('Сначала выберите дату');
                return;
            }
            
            const timeInput = document.getElementById('newTimeInput');
            const time = timeInput.value;
            
            if (!time) {
                alert('Введите время');
                return;
            }
            
            const dateStr = selectedScheduleDate.toISOString().split('T')[0];
            
            // Инициализируем массив для даты, если его нет
            if (!masterSchedule[dateStr]) {
                masterSchedule[dateStr] = [];
            }
            
            // Проверяем, нет ли уже этого времени
            if (!masterSchedule[dateStr].includes(time)) {
                masterSchedule[dateStr].push(time);
                
                // Сохраняем в localStorage
                saveMasterSchedule();
                
                // Обновляем отображение
                loadTimeSlotsForDate(selectedScheduleDate);
                renderScheduleCalendar();
                renderWeekSchedule();
                
                // Очищаем поле ввода
                timeInput.value = '';
            } else {
                alert('Это время уже добавлено');
            }
        }

        function removeTimeSlot(dateStr, time) {
            if (confirm('Удалить это время из расписания?')) {
                const index = masterSchedule[dateStr].indexOf(time);
                if (index !== -1) {
                    masterSchedule[dateStr].splice(index, 1);
                    
                    // Если слотов не осталось, удаляем дату
                    if (masterSchedule[dateStr].length === 0) {
                        delete masterSchedule[dateStr];
                    }
                    
                    // Сохраняем в localStorage
                    saveMasterSchedule();
                    
                    // Обновляем отображение
                    loadTimeSlotsForDate(selectedScheduleDate);
                    renderScheduleCalendar();
                    renderWeekSchedule();
                }
            }
        }

        function saveDailySchedule() {
            if (!selectedScheduleDate) return;
            
            saveMasterSchedule();
            showMessage('Расписание сохранено!', 'success');
        }

        function clearDailySchedule() {
            if (!selectedScheduleDate || !confirm('Очистить все время работы на этот день?')) {
                return;
            }
            
            const dateStr = selectedScheduleDate.toISOString().split('T')[0];
            delete masterSchedule[dateStr];
            
            saveMasterSchedule();
            loadTimeSlotsForDate(selectedScheduleDate);
            renderScheduleCalendar();
            renderWeekSchedule();
            
            showMessage('Расписание очищено', 'success');
        }

        function renderWeekSchedule() {
            const table = document.getElementById('weekScheduleTable');
            if (!table) return;
            
            table.innerHTML = '';
            
            const weekDates = getWeekDates(scheduleWeekStart);
            const bookings = Zapis5MinData.getBookings();
            
            weekDates.forEach(date => {
                const dateStr = date.toISOString().split('T')[0];
                const daySlots = masterSchedule[dateStr] || [];
                
                // Количество записей на этот день
                const dayBookings = bookings.filter(b => 
                    b.master_id === currentMaster.id && 
                    b.date === dateStr &&
                    b.status === 'confirmed'
                ).length;
                
                const dayNames = ['Понедельник', 'Вторник', 'Среда', 'Четверг', 'Пятница', 'Суббота', 'Воскресенье'];
                const dayName = dayNames[date.getDay() === 0 ? 6 : date.getDay() - 1];
                
                const formattedDate = date.toLocaleDateString('ru-RU', {
                    day: 'numeric',
                    month: 'short'
                });
                
                const timeString = daySlots.length > 0 
                    ? daySlots.sort().map(t => formatTime(t)).join(', ')
                    : 'Не работает';
                
                const status = daySlots.length > 0 ? 'Работает' : 'Выходной';
                const statusClass = daySlots.length > 0 ? 'status-confirmed' : 'status-cancelled';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${dayName}</td>
                    <td>${formattedDate}</td>
                    <td>${timeString}</td>
                    <td>${dayBookings}</td>
                    <td><span class="status-badge ${statusClass}">${status}</span></td>
                `;
                
                table.appendChild(row);
            });
        }

        function changeScheduleWeek(delta) {
            scheduleWeekStart.setDate(scheduleWeekStart.getDate() + delta * 7);
            
            // Обновляем отображение недели
            const weekFormatter = new Intl.DateTimeFormat('ru-RU', {
                day: 'numeric',
                month: 'long'
            });
            
            const weekEnd = new Date(scheduleWeekStart);
            weekEnd.setDate(weekEnd.getDate() + 6);
            
            document.getElementById('scheduleWeek').textContent = 
                `${weekFormatter.format(scheduleWeekStart)} - ${weekFormatter.format(weekEnd)}`;
            
            // Обновляем календарь и таблицу
            renderScheduleCalendar();
            renderWeekSchedule();
        }

        function copyScheduleToNextWeek() {
            if (!confirm('Скопировать текущее расписание на следующую неделю?')) {
                return;
            }
            
            const nextWeekStart = new Date(scheduleWeekStart);
            nextWeekStart.setDate(nextWeekStart.getDate() + 7);
            
            const currentWeekDates = getWeekDates(scheduleWeekStart);
            const nextWeekDates = getWeekDates(nextWeekStart);
            
            // Копируем расписание
            currentWeekDates.forEach((date, index) => {
                const currentDateStr = date.toISOString().split('T')[0];
                const nextDateStr = nextWeekDates[index].toISOString().split('T')[0];
                
                if (masterSchedule[currentDateStr]) {
                    masterSchedule[nextDateStr] = [...masterSchedule[currentDateStr]];
                } else {
                    delete masterSchedule[nextDateStr];
                }
            });
            
            saveMasterSchedule();
            showMessage('Расписание скопировано на следующую неделю!', 'success');
            
            // Переходим на следующую неделю
            changeScheduleWeek(1);
        }

        function loadMasterSchedule() {
            const savedSchedule = localStorage.getItem(`master_schedule_${currentMaster?.id}`);
            if (savedSchedule) {
                masterSchedule = JSON.parse(savedSchedule);
            } else {
                // Создаем расписание по умолчанию
                masterSchedule = createDefaultSchedule();
                saveMasterSchedule();
            }
        }

        function saveMasterSchedule() {
            if (currentMaster) {
                localStorage.setItem(`master_schedule_${currentMaster.id}`, JSON.stringify(masterSchedule));
            }
        }

        function createDefaultSchedule() {
            const schedule = {};
            const today = new Date();
            
            // Создаем расписание на 2 недели вперед
            for (let i = 0; i < 14; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() + i);
                const dateStr = date.toISOString().split('T')[0];
                
                // Рабочие дни (пн-пт)
                if (date.getDay() >= 1 && date.getDay() <= 5) {
                    schedule[dateStr] = ['10:00', '11:00', '12:00', '14:00', '15:00', '16:00', '17:00'];
                }
                // Суббота
                else if (date.getDay() === 6) {
                    schedule[dateStr] = ['11:00', '12:00', '13:00', '14:00', '15:00'];
                }
                // Воскресенье - выходной
            }
            
            return schedule;
        }

        // ЗАПИСИ КЛИЕНТОВ
        function loadAllBookings() {
            if (!currentMaster) return;
            
            const bookings = Zapis5MinData.getBookings();
            const users = Zapis5MinData.getUsers();
            
            const masterBookings = bookings.filter(b => b.master_id === currentMaster.id)
                .sort((a, b) => {
                    const dateA = new Date(a.date + 'T' + a.time);
                    const dateB = new Date(b.date + 'T' + b.time);
                    return dateB - dateA; // Новые сверху
                });
            
            const table = document.getElementById('bookingsTable');
            if (!table) return;
            
            if (masterBookings.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <i class="fas fa-calendar-times"></i>
                            <p>Нет записей</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            table.innerHTML = '';
            
            masterBookings.forEach(booking => {
                const client = users.find(u => u.id === booking.client_id);
                const service = getServiceById(booking.service_id);
                
                const bookingDate = new Date(booking.date);
                const dateString = bookingDate.toLocaleDateString('ru-RU', {
                    day: 'numeric',
                    month: 'short'
                });
                const timeString = formatTime(booking.time);
                
                let statusBadge = '';
                switch(booking.status) {
                    case 'confirmed':
                        statusBadge = '<span class="status-badge status-confirmed">✓ Подтверждена</span>';
                        break;
                    case 'pending_payment':
                        statusBadge = '<span class="status-badge status-pending">⏳ Ожидает оплаты</span>';
                        break;
                    case 'cancelled':
                        statusBadge = '<span class="status-badge status-cancelled">✗ Отменена</span>';
                        break;
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div>${dateString}</div>
                        <div style="color: var(--text-gray); font-size: 14px;">${timeString}</div>
                    </td>
                    <td>
                        <div style="color: var(--text-light); font-weight: 500;">${client?.name || 'Клиент'}</div>
                    </td>
                    <td>${service?.name || 'Услуга'}</td>
                    <td>${client?.phone || '—'}</td>
                    <td><strong>${booking.price?.toLocaleString() || '0'} ₽</strong></td>
                    <td>${statusBadge}</td>
                    <td>
                        <div style="display: flex; gap: 8px;">
                            <button class="action-btn" title="Подробнее" onclick="showBookingDetails(${booking.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="action-btn" title="Подтвердить" onclick="confirmBooking(${booking.id})" ${booking.status === 'confirmed' ? 'disabled' : ''}>
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="action-btn" title="Отменить" onclick="showCancelModal(${booking.id})" ${booking.status === 'cancelled' ? 'disabled' : ''}>
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                table.appendChild(row);
            });
        }

        function filterBookings() {
            const searchQuery = document.getElementById('bookingsSearch').value.toLowerCase();
            const filterValue = document.getElementById('bookingsFilter').value;
            
            const rows = document.querySelectorAll('#bookingsTable tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                const statusMatch = filterValue === 'all' || row.innerHTML.includes(filterValue);
                const searchMatch = text.includes(searchQuery);
                
                row.style.display = (statusMatch && searchMatch) ? '' : 'none';
            });
        }

        function changeBookingsView(view) {
            // Обновляем активную кнопку
            document.querySelectorAll('.date-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // В реальном приложении здесь была бы фильтрация по периоду
            // Для демо просто показываем все записи
            loadAllBookings();
        }

        function showCancelModal(bookingId) {
            const bookings = Zapis5MinData.getBookings();
            const users = Zapis5MinData.getUsers();
            
            const booking = bookings.find(b => b.id === bookingId);
            const client = users.find(u => u.id === booking.client_id);
            
            if (!booking || !client) return;
            
            bookingToCancel = bookingId;
            
            // Заполняем модальное окно
            document.getElementById('cancelClientName').textContent = client.name;
            document.getElementById('cancelClientPhone').textContent = client.phone;
            
            const bookingDate = new Date(booking.date);
            const dateString = bookingDate.toLocaleDateString('ru-RU', {
                day: 'numeric',
                month: 'long'
            });
            
            document.getElementById('cancelDateTime').textContent = `${dateString}, ${formatTime(booking.time)}`;
            
            // Показываем модальное окно
            document.getElementById('cancelBookingModal').classList.add('active');
        }

        function closeCancelModal() {
            document.getElementById('cancelBookingModal').classList.remove('active');
            bookingToCancel = null;
        }

        function confirmCancelBooking() {
            if (!bookingToCancel) return;
            
            // Обновляем статус записи
            const bookings = Zapis5MinData.getBookings();
            const bookingIndex = bookings.findIndex(b => b.id === bookingToCancel);
            
            if (bookingIndex !== -1) {
                bookings[bookingIndex].status = 'cancelled';
                bookings[bookingIndex].cancelled_at = new Date().toISOString();
                bookings[bookingIndex].cancelled_by = 'master';
                
                Zapis5MinData.updateBookings(bookings);
                
                // Закрываем модальное окно
                closeCancelModal();
                
                // Обновляем отображение
                loadAllBookings();
                loadDashboardStats();
                loadUpcomingBookings();
                
                showMessage('Запись отменена. Не забудьте вернуть предоплату клиенту в течение 24 часов.', 'success');
            }
        }

        function confirmBooking(bookingId) {
            const bookings = Zapis5MinData.getBookings();
            const bookingIndex = bookings.findIndex(b => b.id === bookingId);
            
            if (bookingIndex !== -1) {
                bookings[bookingIndex].status = 'confirmed';
                Zapis5MinData.updateBookings(bookings);
                
                showMessage('Запись подтверждена!', 'success');
                
                // Обновляем отображение
                loadAllBookings();
                loadDashboardStats();
                loadUpcomingBookings();
            }
        }

        // УСЛУГИ И ЦЕНЫ
        function showAddServiceForm() {
            document.getElementById('addServiceForm').style.display = 'block';
            document.getElementById('serviceName').focus();
        }

        function hideAddServiceForm() {
            document.getElementById('addServiceForm').style.display = 'none';
        }

        function addService() {
            const name = document.getElementById('serviceName').value.trim();
            const category = document.getElementById('serviceCategory').value;
            const price = parseInt(document.getElementById('servicePrice').value) || 0;
            const duration = parseInt(document.getElementById('serviceDuration').value) || 60;
            const description = document.getElementById('serviceDescription').value.trim();
            
            if (!name || price <= 0) {
                showMessage('Заполните название услуги и укажите цену', 'error');
                return;
            }
            
            // Создаем новую услугу
            const newService = {
                id: masterServices.length > 0 ? Math.max(...masterServices.map(s => s.id)) + 1 : 1,
                name: name,
                category: category,
                price: price,
                duration: duration,
                description: description,
                popularity: 0
            };
            
            masterServices.push(newService);
            saveMasterServices();
            
            // Скрываем форму и обновляем таблицу
            hideAddServiceForm();
            loadMasterServices();
            
            // Сбрасываем форму
            document.getElementById('serviceName').value = '';
            document.getElementById('servicePrice').value = '';
            document.getElementById('serviceDescription').value = '';
            
            showMessage('Услуга добавлена!', 'success');
        }

        function loadMasterServices() {
            if (!currentMaster) return;
            
            // Загружаем услуги мастера
            const savedServices = localStorage.getItem(`master_services_${currentMaster.id}`);
            if (savedServices) {
                masterServices = JSON.parse(savedServices);
            } else {
                // Используем услуги из профиля мастера
                masterServices = currentMaster.services || [];
                saveMasterServices();
            }
            
            const table = document.getElementById('servicesTable');
            if (!table) return;
            
            if (masterServices.length === 0) {
                table.innerHTML = `
                    <tr>
                        <td colspan="6" class="empty-state">
                            <i class="fas fa-spa"></i>
                            <p>Нет услуг</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            table.innerHTML = '';
            
            masterServices.forEach(service => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div style="color: var(--text-light); font-weight: 500;">${service.name}</div>
                    </td>
                    <td>
                        <div style="color: var(--text-gray); font-size: 14px;">${service.description || '—'}</div>
                    </td>
                    <td><strong>${service.price.toLocaleString()} ₽</strong></td>
                    <td>${service.duration} мин</td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <div style="width: 100px; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden;">
                                <div style="width: ${Math.min(service.popularity || 0, 100)}%; height: 100%; background: #8A2BE2;"></div>
                            </div>
                            <span style="font-size: 12px; color: var(--text-gray);">${service.popularity || 0}%</span>
                        </div>
                    </td>
                    <td>
                        <div style="display: flex; gap: 8px;">
                            <button class="action-btn" title="Редактировать" onclick="editService(${service.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn" title="Удалить" onclick="deleteService(${service.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                table.appendChild(row);
            });
        }

        function saveMasterServices() {
            if (currentMaster) {
                localStorage.setItem(`master_services_${currentMaster.id}`, JSON.stringify(masterServices));
            }
        }

        function editService(serviceId) {
            const service = masterServices.find(s => s.id === serviceId);
            if (!service) return;
            
            // Заполняем форму редактирования
            document.getElementById('serviceName').value = service.name;
            document.getElementById('serviceCategory').value = service.category;
            document.getElementById('servicePrice').value = service.price;
            document.getElementById('serviceDuration').value = service.duration;
            document.getElementById('serviceDescription').value = service.description || '';
            
            // Показываем форму
            showAddServiceForm();
            
            // Изменяем кнопку
            const submitBtn = document.querySelector('#addServiceForm .form-submit');
            submitBtn.innerHTML = '<i class="fas fa-save"></i> Сохранить изменения';
            submitBtn.onclick = function() { updateService(serviceId); };
        }

        function updateService(serviceId) {
            const serviceIndex = masterServices.findIndex(s => s.id === serviceId);
            if (serviceIndex === -1) return;
            
            const name = document.getElementById('serviceName').value.trim();
            const category = document.getElementById('serviceCategory').value;
            const price = parseInt(document.getElementById('servicePrice').value) || 0;
            const duration = parseInt(document.getElementById('serviceDuration').value) || 60;
            const description = document.getElementById('serviceDescription').value.trim();
            
            if (!name || price <= 0) {
                showMessage('Заполните название услуги и укажите цену', 'error');
                return;
            }
            
            masterServices[serviceIndex] = {
                ...masterServices[serviceIndex],
                name: name,
                category: category,
                price: price,
                duration: duration,
                description: description
            };
            
            saveMasterServices();
            hideAddServiceForm();
            loadMasterServices();
            
            showMessage('Услуга обновлена!', 'success');
        }

        function deleteService(serviceId) {
            if (!confirm('Удалить эту услугу?')) return;
            
            const serviceIndex = masterServices.findIndex(s => s.id === serviceId);
            if (serviceIndex !== -1) {
                masterServices.splice(serviceIndex, 1);
                saveMasterServices();
                loadMasterServices();
                showMessage('Услуга удалена!', 'success');
            }
        }

        // ПОРТФОЛИО
        function loadPortfolio() {
            if (!currentMaster) return;
            
            // Загружаем портфолио из localStorage
            const savedPortfolio = localStorage.getItem(`master_portfolio_${currentMaster.id}`);
            if (savedPortfolio) {
                masterPortfolio = JSON.parse(savedPortfolio);
            } else {
                // Создаем демо-портфолио
                masterPortfolio = createDemoPortfolio();
                savePortfolio();
            }
            
            renderPortfolio();
        }

        function renderPortfolio() {
            const grid = document.getElementById('portfolioGrid');
            if (!grid) return;
            
            grid.innerHTML = '';
            
            // Добавляем кнопку добавления фото
            const addButton = document.createElement('div');
            addButton.className = 'add-photo-btn';
            addButton.innerHTML = `
                <i class="fas fa-plus"></i>
                <div>Добавить фото</div>
            `;
            addButton.onclick = showPhotoUploadModal;
            grid.appendChild(addButton);
            
            // Добавляем фото портфолио
            masterPortfolio.forEach((item, index) => {
                const portfolioItem = document.createElement('div');
                portfolioItem.className = 'portfolio-item';
                
                portfolioItem.innerHTML = `
                    <img src="${item.image}" alt="${item.title}" class="portfolio-image">
                    <div class="portfolio-overlay">
                        <div style="color: white;">
                            <div style="font-weight: 600; margin-bottom: 5px;">${item.title}</div>
                            <div style="font-size: 14px;">${item.service}</div>
                        </div>
                    </div>
                    <div class="portfolio-actions">
                        <button class="portfolio-btn" onclick="editPortfolioItem(${index})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="portfolio-btn" onclick="deletePortfolioItem(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                grid.appendChild(portfolioItem);
            });
        }

        function showPhotoUploadModal() {
            document.getElementById('photoUploadModal').classList.add('active');
            document.getElementById('photoPreview').style.display = 'none';
            document.getElementById('photoTitle').value = '';
            document.getElementById('photoDescription').value = '';
        }

        function closePhotoUploadModal() {
            document.getElementById('photoUploadModal').classList.remove('active');
        }

        function previewPhoto(input) {
            const preview = document.getElementById('photoPreview');
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                }
                
                reader.readAsDataURL(input.files[0]);
            }
        }

        function uploadPhoto() {
            const title = document.getElementById('photoTitle').value.trim();
            const service = document.getElementById('photoService').value;
            const description = document.getElementById('photoDescription').value.trim();
            const preview = document.getElementById('photoPreview');
            
            if (!title) {
                showMessage('Введите название работы', 'error');
                return;
            }
            
            if (preview.style.display === 'none') {
                showMessage('Выберите фото для загрузки', 'error');
                return;
            }
            
            const serviceNames = {
                'MANICURE_PEDICURE': 'Маникюр',
                'MEN_HAIRCUT': 'Мужская стрижка',
                'WOMEN_HAIRCUT': 'Женская стрижка',
                'EYEBROWS': 'Брови',
                'EYELASHES': 'Ресницы'
            };
            
            const newItem = {
                id: masterPortfolio.length + 1,
                image: preview.src,
                title: title,
                service: serviceNames[service] || service,
                serviceCategory: service,
                description: description,
                date: new Date().toISOString()
            };
            
            masterPortfolio.push(newItem);
            savePortfolio();
            renderPortfolio();
            closePhotoUploadModal();
            
            showMessage('Фото успешно добавлено в портфолио!', 'success');
        }

        function editPortfolioItem(index) {
            const item = masterPortfolio[index];
            if (!item) return;
            
            const newTitle = prompt('Введите новое название работы:', item.title);
            const newDescription = prompt('Введите новое описание:', item.description || '');
            
            if (newTitle !== null) {
                masterPortfolio[index].title = newTitle;
                if (newDescription !== null) {
                    masterPortfolio[index].description = newDescription;
                }
                savePortfolio();
                renderPortfolio();
                showMessage('Работа обновлена!', 'success');
            }
        }

        function deletePortfolioItem(index) {
            if (confirm('Удалить эту работу из портфолио?')) {
                masterPortfolio.splice(index, 1);
                savePortfolio();
                renderPortfolio();
                showMessage('Работа удалена!', 'success');
            }
        }

        function savePortfolio() {
            if (currentMaster) {
                localStorage.setItem(`master_portfolio_${currentMaster.id}`, JSON.stringify(masterPortfolio));
            }
        }

        function createDemoPortfolio() {
            return [
                {
                    id: 1,
                    image: 'https://via.placeholder.com/250x200/FF6B8B/FFFFFF?text=Маникюр+2024',
                    title: 'Классический маникюр',
                    service: 'Маникюр',
                    serviceCategory: 'MANICURE_PEDICURE',
                    description: 'Классический маникюр с покрытием гель-лаком',
                    date: '2024-03-15'
                },
                {
                    id: 2,
                    image: 'https://via.placeholder.com/250x200/4CAF50/FFFFFF?text=Стрижка+2024',
                    title: 'Женская стрижка',
                    service: 'Женская стрижка',
                    serviceCategory: 'WOMEN_HAIRCUT',
                    description: 'Модная стрижка каскад',
                    date: '2024-03-10'
                },
                {
                    id: 3,
                    image: 'https://via.placeholder.com/250x200/2196F3/FFFFFF?text=Брови+2024',
                    title: 'Коррекция бровей',
                    service: 'Брови',
                    serviceCategory: 'EYEBROWS',
                    description: 'Коррекция и окрашивание бровей',
                    date: '2024-03-05'
                }
            ];
        }

        // ОТЗЫВЫ
        function loadReviews() {
            if (!currentMaster) return;
            
            const reviews = Zapis5MinData.getReviews();
            const users = Zapis5MinData.getUsers();
            
            // Фильтруем отзывы для текущего мастера
            masterReviews = reviews.filter(r => r.master_id === currentMaster.id)
                .sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
            
            // Обновляем отображение рейтинга
            updateRatingDisplay();
            
            // Отображаем отзывы
            renderReviews();
        }

        function renderReviews() {
            const grid = document.getElementById('reviewsGrid');
            if (!grid) return;
            
            if (masterReviews.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <i class="fas fa-star"></i>
                        <h3 style="color: var(--text-light); margin-bottom: 10px;">Пока нет отзывов</h3>
                        <p>Отзывы появятся после работы с клиентами</p>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = '';
            
            masterReviews.forEach(review => {
                const client = Zapis5MinData.getUsers().find(u => u.id === review.client_id);
                const service = getServiceById(review.service_id);
                
                const reviewDate = new Date(review.created_at);
                const dateString = reviewDate.toLocaleDateString('ru-RU');
                
                // Создаем звезды
                let stars = '';
                for (let i = 1; i <= 5; i++) {
                    if (i <= review.rating) {
                        stars += '<i class="fas fa-star"></i>';
                    } else {
                        stars += '<i class="far fa-star"></i>';
                    }
                }
                
                const reviewCard = document.createElement('div');
                reviewCard.className = 'review-card';
                reviewCard.innerHTML = `
                    <div class="review-header">
                        <div class="review-client">
                            <div class="client-avatar-small">
                                ${getInitials(client?.name || 'Клиент')}
                            </div>
                            <div class="client-info-small">
                                <h4>${client?.name || 'Клиент'}</h4>
                                <p>${dateString}</p>
                            </div>
                        </div>
                        <div class="review-rating">
                            ${stars}
                        </div>
                    </div>
                    
                    <div class="review-text">
                        ${review.comment || 'Клиент не оставил комментарий'}
                    </div>
                    
                    ${service ? `<div class="review-service">Услуга: ${service.name}</div>` : ''}
                `;
                
                grid.appendChild(reviewCard);
            });
        }

        function filterReviews(rating) {
            const grid = document.getElementById('reviewsGrid');
            if (!grid || !masterReviews.length) return;
            
            if (rating === 'all') {
                renderReviews();
                return;
            }
            
            const filteredReviews = masterReviews.filter(r => r.rating === parseInt(rating));
            
            if (filteredReviews.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <i class="fas fa-star"></i>
                        <h3 style="color: var(--text-light); margin-bottom: 10px;">Нет отзывов с ${rating} звездами</h3>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = '';
            
            filteredReviews.forEach(review => {
                const client = Zapis5MinData.getUsers().find(u => u.id === review.client_id);
                const service = getServiceById(review.service_id);
                
                const reviewDate = new Date(review.created_at);
                const dateString = reviewDate.toLocaleDateString('ru-RU');
                
                // Создаем звезды
                let stars = '';
                for (let i = 1; i <= 5; i++) {
                    if (i <= review.rating) {
                        stars += '<i class="fas fa-star"></i>';
                    } else {
                        stars += '<i class="far fa-star"></i>';
                    }
                }
                
                const reviewCard = document.createElement('div');
                reviewCard.className = 'review-card';
                reviewCard.innerHTML = `
                    <div class="review-header">
                        <div class="review-client">
                            <div class="client-avatar-small">
                                ${getInitials(client?.name || 'Клиент')}
                            </div>
                            <div class="client-info-small">
                                <h4>${client?.name || 'Клиент'}</h4>
                                <p>${dateString}</p>
                            </div>
                        </div>
                        <div class="review-rating">
                            ${stars}
                        </div>
                    </div>
                    
                    <div class="review-text">
                        ${review.comment || 'Клиент не оставил комментарий'}
                    </div>
                    
                    ${service ? `<div class="review-service">Услуга: ${service.name}</div>` : ''}
                `;
                
                grid.appendChild(reviewCard);
            });
        }

        // НАСТРОЙКИ
        function saveSettings() {
            // Собираем настройки
            const settings = {
                notifyEmail: document.getElementById('notifyEmail').checked,
                notifySMS: document.getElementById('notifySMS').checked,
                notifyTelegram: document.getElementById('notifyTelegram').checked,
                autoConfirmBookings: document.getElementById('autoConfirmBookings').checked,
                confirmTime: parseInt(document.getElementById('confirmTime').value),
                prepaymentPercent: parseInt(document.getElementById('prepaymentPercent').value)
            };
            
            // Сохраняем настройки
            if (currentMaster) {
                localStorage.setItem(`master_settings_${currentMaster.id}`, JSON.stringify(settings));
            }
            
            showMessage('Настройки сохранены!', 'success');
        }

        function downloadQRCode() {
            // В реальном приложении здесь генерировался бы QR-код
            showMessage('QR-код скачан! В реальном приложении здесь генерировался бы QR-код со ссылкой на запись к мастеру.', 'success');
        }

        // ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ
        function getInitials(name) {
            return name ? name.split(' ').map(word => word[0]).join('').toUpperCase().slice(0, 2) : 'МК';
        }

        function formatTime(time) {
            if (!time) return '';
            
            if (time.includes(':')) {
                const [hours, minutes] = time.split(':');
                return `${hours.padStart(2, '0')}:${minutes.padStart(2, '0')}`;
            }
            
            return time;
        }

        function getWeekStart(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - (day === 0 ? 6 : day - 1); // Понедельник как начало недели
            return new Date(d.setDate(diff));
        }

        function getWeekDates(startDate) {
            const dates = [];
            const date = new Date(startDate);
            
            for (let i = 0; i < 7; i++) {
                const currentDate = new Date(date);
                currentDate.setDate(date.getDate() + i);
                dates.push(currentDate);
            }
            
            return dates;
        }

        function getServiceById(serviceId) {
            // Ищем услугу в сервисах мастера
            if (masterServices && masterServices.length > 0) {
                const service = masterServices.find(s => s.id === serviceId);
                if (service) return service;
            }
            
            // Если не нашли, ищем в общих услугах
            const allServices = Zapis5MinData.getServices();
            return allServices.find(s => s.id === serviceId);
        }

        function changeDate(delta) {
            currentDate.setDate(currentDate.getDate() + delta);
            updateDateDisplay();
            loadUpcomingBookings();
        }

        function updateDateDisplay() {
            const formatter = new Intl.DateTimeFormat('ru-RU', {
                weekday: 'long',
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
            
            document.getElementById('currentDate').textContent = formatter.format(currentDate);
        }

        function showAvatarUpload() {
            // В реальном приложении здесь был бы загрузчик файлов
            const newAvatarUrl = prompt('Введите URL новой аватарки:', 'https://via.placeholder.com/100/8A2BE2/FFFFFF?text=АВ');
            
            if (newAvatarUrl) {
                const avatarDiv = document.getElementById('masterAvatar');
                avatarDiv.innerHTML = `
                    <img src="${newAvatarUrl}" alt="Аватар">
                    <div class="avatar-change">Изменить</div>
                `;
                
                // Сохраняем URL аватарки
                if (currentMaster) {
                    const masters = Zapis5MinData.getMasters();
                    const masterIndex = masters.findIndex(m => m.id === currentMaster.id);
                    
                    if (masterIndex !== -1) {
                        masters[masterIndex].avatar_url = newAvatarUrl;
                        Zapis5MinData.updateMasters(masters);
                        currentMaster = masters[masterIndex];
                        
                        showMessage('Аватар обновлен!', 'success');
                    }
                }
            }
        }

        function showBookingDetails(bookingId) {
            const bookings = Zapis5MinData.getBookings();
            const booking = bookings.find(b => b.id === bookingId);
            
            if (booking) {
                const client = Zapis5MinData.getUsers().find(u => u.id === booking.client_id);
                const service = getServiceById(booking.service_id);
                
                const details = `
                    Детали записи ID: ${booking.id}
                    
                    Клиент: ${client?.name || 'Неизвестно'}
                    Телефон: ${client?.phone || 'Не указан'}
                    Услуга: ${service?.name || 'Неизвестно'}
                    Дата: ${booking.date}
                    Время: ${booking.time}
                    Стоимость: ${booking.price} ₽
                    Статус: ${booking.status}
                    Предоплата: ${booking.prepayment} ₽
                `;
                
                alert(details);
            }
        }

        function logout() {
            if (confirm('Вы действительно хотите выйти?')) {
                localStorage.removeItem('current_user');
                window.location.href = 'index.html';
            }
        }
        
        // Функция showMessage из main.js
        function showMessage(message, type = 'success') {
            // Удаляем старые сообщения
            const oldMessage = document.querySelector('.message-alert');
            if (oldMessage) oldMessage.remove();

            // Создаем новое сообщение
            const alertDiv = document.createElement('div');
            alertDiv.className = `message-alert ${type}`;
            alertDiv.textContent = message;
            alertDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 25px;
                border-radius: 10px;
                color: white;
                font-weight: 500;
                z-index: 9999;
                animation: slideIn 0.3s ease;
            `;
            
            if (type === 'success') {
                alertDiv.style.background = 'linear-gradient(45deg, #8A2BE2, #9370DB)';
            } else if (type === 'error') {
                alertDiv.style.background = 'linear-gradient(45deg, #ff4757, #ff6b6b)';
            } else {
                alertDiv.style.background = 'linear-gradient(45deg, #2196F3, #1976D2)';
            }

            document.body.appendChild(alertDiv);

            // Автоматическое скрытие
            setTimeout(() => {
                alertDiv.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => alertDiv.remove(), 300);
            }, 3000);
        }
    </script>
</body>
</html>